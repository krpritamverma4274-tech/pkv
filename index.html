<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Portal Pro</title>
    <style>
        :root { --blue: #1a73e8; --green: #28a745; --red: #d93025; --yellow: #fbbc04; --gray: #5f6368; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f4f6f9; }

        /* Screens */
        .screen { display: none; min-height: 100vh; padding: 20px; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }

        /* Dashboard & Test List */
        .box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 950px; text-align: center; }
        .test-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 15px; margin-top: 20px; }
        
        /* TEST STATUS COLORS */
        .test-item { padding: 15px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; font-weight: bold; background: white; }
        .test-item.completed { background-color: #d4edda !important; border-color: var(--green) !important; color: #155724; }
        .test-item.in-progress { background-color: #fff3cd !important; border-color: var(--yellow) !important; }

        /* Quiz UI */
        header { background: white; border-bottom: 2px solid #ddd; padding: 12px 5%; width: 100%; display: none; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        
        /* OPTION COLORS (The Fix) */
        .opt { display: block; padding: 15px; border: 1px solid #dadce0; margin: 10px 0; border-radius: 8px; cursor: pointer; text-align: left; position: relative; }
        
        /* In Review Mode */
        .opt.correct-ans { background-color: #d4edda !important; border-color: var(--green) !important; color: #155724; font-weight: bold; }
        .opt.wrong-ans { background-color: #f8d7da !important; border-color: var(--red) !important; color: #721c24; }

        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-blue { background: var(--blue); color: white; }
        .btn-gray { background: #e8eaed; color: #3c4043; }
        
        .palette { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 15px; }
        .dot { width: 40px; height: 40px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; border-radius: 6px; cursor: pointer; }
        .dot.done { background: var(--green); color: white; border: none; }
        .dot.curr { border: 2px solid var(--blue); color: var(--blue); }
    </style>
</head>
<body>

    <header id="quiz-header">
        <button class="btn btn-gray" id="exit-btn" onclick="saveAndExit()">‚Üê Exit</button>
        <div id="test-info" style="font-weight: bold;">Test</div>
        <div id="timer" style="color: var(--red); font-weight: bold; font-size: 20px;">60:00</div>
        <button class="btn btn-blue" id="finish-btn" onclick="submitTest()">Finish</button>
        <button class="btn btn-gray" id="rev-exit" style="display:none;" onclick="location.reload()">Back to Home</button>
    </header>

    <div id="scr-reg" class="screen active">
        <div class="box" style="max-width: 400px;">
            <h2>Portal Login</h2>
            <input type="text" id="username" placeholder="Full Name" style="width:100%; padding:12px; margin:20px 0; border:1px solid #ddd; border-radius:6px;">
            <button class="btn btn-blue" style="width:100%" onclick="login()">Enter Dashboard</button>
        </div>
    </div>

    <div id="scr-dash" class="screen">
        <div class="box">
            <h2 id="welcome-msg">Welcome</h2>
            <div style="display:flex; gap:20px; margin-top:20px; justify-content:center; flex-wrap:wrap;">
                <div class="box" style="cursor:pointer; border:1px solid #eee; flex:1;" onclick="showTestList('railway')">üöÇ Railway Exam</div>
                <div class="box" style="cursor:pointer; border:1px solid #eee; flex:1;" onclick="showTestList('ssc')">üèõÔ∏è SSC Exam</div>
            </div>
        </div>
    </div>

    <div id="scr-list" class="screen">
        <div class="box">
            <h2 id="list-title">Tests</h2>
            <div class="test-grid" id="test-grid"></div>
            <button class="btn btn-gray" style="margin-top:20px;" onclick="nav('scr-dash')">‚Üê Back</button>
        </div>
    </div>

    <div id="scr-quiz" class="screen" style="justify-content: flex-start; padding-top: 20px;">
        <div style="display:flex; gap:20px; width:100%; max-width:1150px; flex-wrap: wrap;">
            <div style="flex:2; background:white; padding:30px; border-radius:12px; min-height:500px; text-align:left;">
                <h3 id="q-no">Q1</h3>
                <p id="q-txt" style="margin:25px 0; font-size:20px; line-height:1.4;"></p>
                <div id="opt-box"></div>
                <div id="solution" style="display:none; padding:15px; background:#e8f0fe; border-radius:8px; margin-top:15px; border-left: 5px solid var(--blue);"></div>
                <div style="margin-top:40px; border-top:1px solid #eee; padding-top:20px;">
                    <button class="btn btn-gray" onclick="moveQ(-1)">Previous</button>
                    <button class="btn btn-blue" onclick="moveQ(1)">Save & Next</button>
                </div>
            </div>
            <div style="flex:0.8; background:white; padding:20px; border-radius:12px; height:fit-content; width:100%;">
                <h4>Palette</h4>
                <div class="palette" id="palette"></div>
            </div>
        </div>
    </div>

    <div id="scr-res" class="screen">
        <div class="box" style="max-width:500px;">
            <h2>Test Analysis</h2>
            <h1 id="score-val" style="font-size:65px; color:var(--blue); margin:20px 0;">0</h1>
            <p id="stat-line" style="font-size:18px; color:var(--gray);"></p>
            <div style="display:flex; gap:10px; margin-top:30px; justify-content:center;">
                <button class="btn btn-blue" onclick="startReview()">Review Answers</button>
                <button class="btn btn-gray" onclick="location.reload()">Dashboard</button>
            </div>
        </div>
    </div>

    <script>
        const questionBank = [
            { q: "What is the capital of India?", o: ["Mumbai", "Delhi", "Pune", "Goa"], a: 1, e: "New Delhi is the official capital since 1911." },
            { q: "Power's S.I. unit is?", o: ["Joule", "Watt", "Newton", "Volt"], a: 1, e: "Watt is defined as 1 Joule per second." },
            { q: "‚àö625 = ?", o: ["15", "25", "35", "45"], a: 1, e: "25 multiplied by 25 equals 625." }
        ];

        let state = {
            user: JSON.parse(localStorage.getItem('user_v2')),
            examKey: '', testId: '', qIdx: 0, ans: [], time: 3600, timer: null, isReview: false
        };

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('quiz-header').style.display = (id === 'scr-quiz') ? 'flex' : 'none';
        }

        window.onload = () => { if(state.user) { document.getElementById('welcome-msg').innerText = "Hi, " + state.user; nav('scr-dash'); } };

        function login() {
            let n = document.getElementById('username').value;
            if(!n) return;
            state.user = n;
            localStorage.setItem('user_v2', JSON.stringify(n));
            location.reload();
        }

        function showTestList(ex) {
            state.examKey = ex;
            let html = "";
            for(let i=1; i<=100; i++) {
                let id = ex + "_t_" + i;
                let done = localStorage.getItem(id + "_done");
                let saved = localStorage.getItem(id);
                let cls = "test-item";
                if(done) cls += " completed";
                else if(saved) cls += " in-progress";
                html += `<div class="${cls}" onclick="loadTest('${id}', ${i})">Test ${i}</div>`;
            }
            document.getElementById('test-grid').innerHTML = html;
            nav('scr-list');
        }

        function loadTest(id, n) {
            state.testId = id;
            let saved = JSON.parse(localStorage.getItem(id));
            if(saved) { state.ans = saved.ans; state.time = saved.time; state.qIdx = saved.qIdx; }
            else { state.ans = new Array(questionBank.length).fill(null); state.time = 3600; state.qIdx = 0; }
            state.isReview = false;
            document.getElementById('test-info').innerText = "Test " + n;
            document.getElementById('finish-btn').style.display = "block";
            document.getElementById('exit-btn').style.display = "block";
            document.getElementById('timer').style.display = "block";
            document.getElementById('rev-exit').style.display = "none";
            nav('scr-quiz'); startTimer(); renderQ();
        }

        function startTimer() {
            if(state.timer) clearInterval(state.timer);
            state.timer = setInterval(() => {
                state.time--;
                let m = Math.floor(state.time/60), s = state.time%60;
                document.getElementById('timer').innerText = `${m}:${s<10?'0'+s:s}`;
                if(state.time % 10 === 0) autoSave();
                if(state.time <= 0) submitTest();
            }, 1000);
        }

        function renderQ() {
            let q = questionBank[state.qIdx];
            document.getElementById('q-no').innerText = "Question " + (state.qIdx + 1);
            document.getElementById('q-txt').innerText = q.q;
            
            let html = "";
            q.o.forEach((opt, i) => {
                let cls = "opt";
                if(state.isReview) {
                    if(i === q.a) cls += " correct-ans"; // GREEN
                    else if(state.ans[state.qIdx] === i) cls += " wrong-ans"; // RED
                }
                let chk = (state.ans[state.qIdx] === i) ? "checked" : "";
                html += `<label class="${cls}"><input type="radio" name="o" onclick="pick(${i})" ${chk} ${state.isReview?'disabled':''}> ${opt}</label>`;
            });
            document.getElementById('opt-box').innerHTML = html;
            
            let sol = document.getElementById('solution');
            if(state.isReview) { sol.style.display="block"; sol.innerHTML="<b>Solution:</b> " + q.e; }
            else sol.style.display="none";
            
            updatePalette();
        }

        function pick(i) { if(!state.isReview) { state.ans[state.qIdx] = i; updatePalette(); autoSave(); } }

        function updatePalette() {
            let html = "";
            for(let i=0; i<questionBank.length; i++) {
                let cls = (i === state.qIdx) ? "dot curr" : (state.ans[i] !== null ? "dot done" : "dot");
                html += `<div class="${cls}" onclick="state.qIdx=${i};renderQ()">${i+1}</div>`;
            }
            document.getElementById('palette').innerHTML = html;
        }

        function autoSave() {
            if(!state.isReview) localStorage.setItem(state.testId, JSON.stringify({ ans: state.ans, time: state.time, qIdx: state.qIdx }));
        }

        function saveAndExit() { autoSave(); clearInterval(state.timer); location.reload(); }

        function submitTest() {
            if(!confirm("Submit Test?")) return;
            clearInterval(state.timer);
            localStorage.setItem(state.testId + "_done", "true");
            localStorage.removeItem(state.testId); // Cleanup
            
            let score = 0, cor = 0, wrg = 0;
            questionBank.forEach((q, i) => {
                if(state.ans[i] === q.a) { score++; cor++; }
                else if(state.ans[i] !== null) { score -= 0.25; wrg++; }
            });
            
            document.getElementById('score-val').innerText = score.toFixed(2);
            document.getElementById('stat-line').innerText = `Correct: ${cor} | Wrong: ${wrg} | Neg: -${(wrg*0.25).toFixed(2)}`;
            nav('scr-res');
        }

        function startReview() {
            state.isReview = true; state.qIdx = 0;
            document.getElementById('finish-btn').style.display = "none";
            document.getElementById('exit-btn').style.display = "none";
            document.getElementById('timer').style.display = "none";
            document.getElementById('rev-exit').style.display = "block";
            nav('scr-quiz'); renderQ();
        }

        function moveQ(d) { let n = state.qIdx + d; if(n >= 0 && n < questionBank.length) { state.qIdx = n; renderQ(); } }
    </script>
</body>
</html>